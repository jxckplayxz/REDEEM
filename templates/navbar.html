<style>
    .sidebar-transition { transition: transform 0.3s ease-in-out; transform: translateX(-100%); }
    .sidebar-open .sidebar-transition { transform: translateX(0); }
    /* Keyframe for subtle drop-in animation */
    @keyframes dropIn {
        0% { opacity: 0; transform: translateY(-20px); }
        100% { opacity: 1; transform: translateY(0); }
    }
    .animate-drop-in { animation: dropIn 0.3s ease-out forwards; }
</style>

<div class="h-20"></div> 
<nav class="bg-gray-900/90 backdrop-blur-sm border border-gray-800 shadow-xl rounded-xl p-4 flex justify-between items-center fixed top-0 left-0 right-0 z-50 mx-auto mt-4 w-[95%] lg:w-[90%] transition duration-300 animate-drop-in">
    <div class="flex items-center gap-2 lg:gap-3">
        <i data-lucide="code" class="w-6 h-6 lg:w-8 lg:h-8 text-indigo-400 animate-pulse"></i>
        <a href="/" class="text-xl lg:text-2xl font-bold text-indigo-400 hover:text-indigo-300 transition duration-150">CodeVault Pro</a>
    </div>

    <div class="hidden lg:flex items-center gap-6">
        {% if current_user.is_authenticated and current_user.is_admin %}
        <a href="/admin" class="text-red-400 hover:text-red-300 flex items-center gap-1 text-base font-bold transition duration-150 hover:scale-105">
            <i data-lucide="shield-half" class="w-5 h-5"></i> Admin
        </a>
        {% endif %}
        <a href="/explore" class="text-gray-300 hover:text-white flex items-center gap-1 text-base transition duration-150 hover:scale-105">
            <i data-lucide="compass" class="w-5 h-5"></i> Explore
        </a>
        {% if current_user.is_authenticated %}
        <a href="/dashboard" class="text-gray-300 hover:text-white flex items-center gap-1 text-base transition duration-150 hover:scale-105">
            <i data-lucide="folder-kanban" class="w-5 h-5"></i> My Code
        </a>
        <a href="/settings" class="text-gray-300 hover:text-white flex items-center gap-1 text-base transition duration-150 hover:scale-105">
            <i data-lucide="settings" class="w-5 h-5"></i> Settings
        </a>
        <a href="/logout" class="text-red-400 hover:text-red-300 flex items-center gap-1 text-base transition duration-150 hover:scale-105">
            <i data-lucide="log-out" class="w-5 h-5"></i> Logout
        </a>
        {% else %}
        <a href="/login" class="bg-indigo-600 hover:bg-indigo-700 px-6 py-2 rounded-lg font-bold flex items-center gap-1 text-sm transition duration-150 hover:scale-[1.03]">
            <i data-lucide="log-in" class="w-4 h-4"></i> Login
        </a>
        {% endif %}
    </div>
    <div class="lg:hidden flex items-center gap-2">
        {% if current_user.is_authenticated %}
        <button id="menu-toggle" class="text-white hover:text-indigo-400 transition duration-150 p-1">
            <i data-lucide="menu" class="w-6 h-6"></i>
        </button>
        {% else %}
        <a href="/login" class="bg-indigo-600 hover:bg-indigo-700 px-3 py-1 rounded-lg font-bold flex items-center gap-1 text-sm transition duration-150 hover:scale-[1.03] active:scale-95">
            <i data-lucide="log-in" class="w-4 h-4"></i> Login
        </a>
        {% endif %}
    </div>
    </nav>

<div id="sidebar" class="sidebar-transition fixed top-0 left-0 h-full w-64 bg-gray-900 z-[60] border-r border-gray-700 p-6 pt-24 lg:hidden">
    <div class="space-y-4">
        {% if current_user.is_authenticated and current_user.is_admin %}
        <a href="/admin" class="block text-red-400 hover:text-red-300 flex items-center gap-3 text-lg p-2 rounded-lg transition duration-150 hover:bg-gray-800 font-bold">
            <i data-lucide="shield-half" class="w-5 h-5"></i> Admin Panel
        </a>
        <div class="h-px bg-gray-700 my-4"></div>
        {% endif %}
        
        <a href="/explore" class="block text-gray-300 hover:text-indigo-400 flex items-center gap-3 text-lg p-2 rounded-lg transition duration-150 hover:bg-gray-800">
            <i data-lucide="compass" class="w-5 h-5"></i> Explore
        </a>

        {% if current_user.is_authenticated %}
        <a href="/dashboard" class="block text-gray-300 hover:text-indigo-400 flex items-center gap-3 text-lg p-2 rounded-lg transition duration-150 hover:bg-gray-800">
            <i data-lucide="folder-kanban" class="w-5 h-5"></i> My Code
        </a>
        <a href="/settings" class="block text-gray-300 hover:text-indigo-400 flex items-center gap-3 text-lg p-2 rounded-lg transition duration-150 hover:bg-gray-800">
            <i data-lucide="settings" class="w-5 h-5"></i> Settings
        </a>
        <div class="h-px bg-gray-700 my-4"></div>
        <a href="/logout" class="block text-red-400 hover:text-red-300 flex items-center gap-3 text-lg p-2 rounded-lg transition duration-150 hover:bg-gray-800">
            <i data-lucide="log-out" class="w-5 h-5"></i> Logout
        </a>
        {% endif %}
    </div>
</div>

<div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-[55] opacity-0 pointer-events-none transition duration-300 lg:hidden"></div>

<script src="https://cdn.jsdelivr.net/npm/lucide/dist/lucide.min.js"></script>
<script>
    lucide.createIcons();
    
    // Mobile Sidebar Logic
    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    const body = document.body;

    if (menuToggle) {
        function toggleSidebar() {
            body.classList.toggle('sidebar-open');
            if (body.classList.contains('sidebar-open')) {
                overlay.style.opacity = '1';
                overlay.style.pointerEvents = 'auto';
                // Prevents body scroll when sidebar is open
                document.documentElement.style.overflow = 'hidden'; 
                document.body.style.overflow = 'hidden';
            } else {
                overlay.style.opacity = '0';
                overlay.style.pointerEvents = 'none';
                document.documentElement.style.overflow = 'auto';
                document.body.style.overflow = 'auto';
            }
        }

        menuToggle.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', toggleSidebar);
        
        document.querySelectorAll('#sidebar a').forEach(link => {
            link.addEventListener('click', () => {
                // Wait for animation to finish before closing
                setTimeout(() => {
                    if (body.classList.contains('sidebar-open')) {
                        toggleSidebar();
                    }
                }, 100); 
            });
        });
    }

</script>
